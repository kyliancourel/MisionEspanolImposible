<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Misi√≥n Espa√±ol Imposible</title>
  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <header>
    <h1>Misi√≥n Espa√±ol Imposible</h1>
    <p>Un jeu pour apprendre l‚Äôespagnol de la 5√®me √† la Licence LLCER.</p>
  </header>

  <!-- Section affichant pr√©nom et bouton d√©connexion -->
  <section id="user-info" style="display:none; margin-bottom: 20px;">
    <p>Bienvenue, <span id="user-name"></span> !</p>
    <button id="btn-logout">D√©connexion</button>
  </section>

  <main>
    <section id="user-access">
      <h2>Inscription / Connexion</h2>
      <button id="btn-create-account">Cr√©er un compte</button>
      <button id="btn-login">Se connecter</button>
    </section>

    <section id="content">
      <!-- S√©quences et le√ßons charg√©es dynamiquement ici -->
    </section>
  </main>

  <footer>
    <small>&copy; 2025 Misi√≥n Espa√±ol Imposible</small>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <script type="module" src="./index.js"></script>
  <script type="module">
    import { auth } from './libs/firebase.js';
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { db } from './libs/firebase.js';
  
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const userDocRef = doc(db, "users", user.uid);
        const userSnap = await getDoc(userDocRef);
        if (userSnap.exists()) {
          const userData = userSnap.data();
          if (userData.isValidated) {
            // ‚úÖ Redirection directe si utilisateur d√©j√† connect√© et valid√©
            window.location.href = "profile.html";
          } else {
            // üîÑ Si pas encore valid√© ‚Üí rediriger vers validate
            window.location.href = "validate.html";
          }
        }
      }
    });
  </script>
  
</body>

</html>